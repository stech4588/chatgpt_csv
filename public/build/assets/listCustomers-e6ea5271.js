import{_ as b,r as d,o as n,c,a as e,w as x,b as C,v as L,n as D,d as l,t as u,i as p,e as _,h as f,F as V,j as E}from"./app-8617d8f9.js";const I={name:"Customers",inject:["authStore"],data(){return{form:new this.$form({searchInput:""}),currentPage:1,totalPages:1,currentPageData:[],customersUpdate:!1,customersAdd:!1,customersDelete:!1,customers:!1,loading:!0,customersView:!1,view:5}},computed:{visiblePaginationLinks(){const t=Math.floor(2.5);let i=Math.max(1,this.currentPage-t),h=Math.min(this.totalPages,i+5-1);this.totalPages>=5&&h===this.totalPages&&(i=Math.max(1,h-5+1));const s=[];for(let r=i;r<=h;r++)s.push(r);return s}},async mounted(){if(scrollToTop(),this.authStore.user===null)this.loading=!1;else{let a=!1;try{const t=["customersAdd","customersUpdate","customersView","customersDelete"],i=await checkPermissions(t);t.forEach(h=>{i[h]&&(this[h]=!0,h==="customersView"&&(a=!0))})}catch(t){handleError(t,this.$toast)}if(a){try{await this.$axios.get(`/api/customers?view=${this.view}`).then(t=>{this.currentPageData=t.data.data.data,this.totalPages=t.data.data.last_page})}catch(t){handleError(t,this.$toast)}this.loading=!1}else this.loading=!1;await this.fetchCustomersList(a)}},methods:{async changePage(a){try{const t=await this.$axios.get(`/api/customers?page=${a}&view=${this.view}&search=${this.form.searchInput}`);this.currentPage=t.data.data.current_page,this.currentPageData=t.data.data.data}catch(t){handleError(t,this.$toast)}},async fetchCustomersList(a){if(a){try{await this.$axios.get(`/api/customers?view=${this.view}`).then(t=>{this.currentPageData=t.data.data.data,this.totalPages=t.data.data.last_page})}catch(t){handleError(t,this.$toast)}this.loading=!1}else this.loading=!1},async deleteCustomers(a){if(await this.showConfirmationDialog("Are you sure you want to delete this Coupons?"))try{await this.$axios.delete(`/api/customer/${a}`).then(i=>{i.data.status===200&&(this.$toast.success(i.data.message,{position:"top-right",duration:3e3}),this.fetchCustomersList(!0))})}catch(i){handleError(i,this.$toast)}},async SearchCustomers(){try{await this.$axios.get("/api/customers",{params:{search:this.form.searchInput,view:this.view}}).then(a=>{this.currentPageData=a.data.data.data,this.totalPages=a.data.data.last_page})}catch(a){handleError(a,this.$toast)}}}},S={key:0},U={key:0},M=e("h1",null,"Users",-1),N={class:"container"},T={class:"row justify-content-center"},$={class:"col-md-8"},A={class:"input-group mb-3"},B={class:"input-group-append"},R=["disabled"],j={class:"text-end my-3"},z={key:0},F={class:"table table-bordered"},O=e("thead",{class:"text-white grey-bg"},[e("tr",null,[e("th",{class:""}," ID "),e("th",{class:"col-1"}," Name "),e("th",{class:"col-1"}," Email "),e("th",{class:"col-2"}," Role "),e("th",{class:"col-8 text-center"}," Action ")])],-1),K={class:"text-center"},q=["onClick"],G={key:1,class:"d-flex justify-content-center align-items-center"},H=e("h3",null,"NO RECORD FOUND",-1),J=[H],Q={key:1},W={key:1};function X(a,t,i,h,s,r){const w=d("has-error"),m=d("font-awesome-icon"),g=d("router-link"),y=d("pagination"),P=d("Unauthorized"),k=d("Loader");return s.loading===!1?(n(),c("div",S,[s.customersView===!0?(n(),c("div",U,[M,e("div",N,[e("div",T,[e("div",$,[e("form",{onSubmit:t[1]||(t[1]=x((...o)=>r.SearchCustomers&&r.SearchCustomers(...o),["prevent"])),onKeydown:t[2]||(t[2]=o=>s.form.onKeydown(o))},[e("div",A,[C(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.form.searchInput=o),class:D([{"is-invalid":s.form.errors.has("searchInput")},"form-control"]),placeholder:"Search Records By TITLE...",type:"text",name:"searchInput"},null,2),[[L,s.form.searchInput]]),l(w,{form:s.form,field:"searchInput"},null,8,["form"]),e("div",B,[e("button",{class:"btn grey-bg ms-2",disabled:s.form.busy},u("Search"),8,R)])])],32)])])]),e("div",j,[s.customersAdd?(n(),p(g,{key:0,to:{name:"customers.add"},class:"btn linked-icon"},{default:_(()=>[l(m,{icon:"plus","fixed-width":""})]),_:1},8,["to"])):f("",!0)]),s.currentPageData.length>0?(n(),c("div",z,[e("table",F,[O,e("tbody",null,[(n(!0),c(V,null,E(s.currentPageData,(o,v)=>(n(),c("tr",{key:v},[e("td",null,u(o.id),1),e("td",null,u(o.name),1),e("td",null,u(o.email),1),e("td",null,u(o.role.name),1),e("td",K,[l(g,{to:{path:`/viewcustomers/${o.id}`},class:"btn linked-icon"},{default:_(()=>[l(m,{icon:"eye","fixed-width":""})]),_:2},1032,["to"]),s.customersUpdate?(n(),p(g,{key:0,to:{path:`/updatecustomers/${o.id}`},class:"btn linked-icon"},{default:_(()=>[l(m,{icon:"pen","fixed-width":""})]),_:2},1032,["to"])):f("",!0),s.customersDelete?(n(),c("button",{key:1,class:"btn linked-icon",onClick:Y=>r.deleteCustomers(o.id)},[l(m,{icon:"trash","fixed-width":""})],8,q)):f("",!0)])]))),128))])]),e("div",null,[l(y,{currentPage:s.currentPage,totalPages:s.totalPages,visiblePaginationLinks:r.visiblePaginationLinks,changePage:r.changePage},null,8,["currentPage","totalPages","visiblePaginationLinks","changePage"])])])):(n(),c("div",G,J))])):(n(),c("div",Q,[l(P)]))])):(n(),c("div",W,[l(k)]))}const tt=b(I,[["render",X]]);export{tt as default};
